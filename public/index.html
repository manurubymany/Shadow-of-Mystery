<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Shadow Of Mystery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="game-container">
        <header>
            <h1>SHADOW OF MYSTERY</h1>
            <h2 id="status-display">Conectando ao V√©u...</h2>
        </header>

        <!-- TELA DE LOGIN -->
        <div id="login-screen">
            <div class="fog-container">
                <div class="fog-layer"></div>
                <div class="fog-layer two"></div>
            </div>
            
            <div class="login-section">
                <label class="section-label">DOM√çNIO (SALA)</label>
                <div class="room-controls">
                    <input type="text" id="room-code" placeholder="C√ìDIGO" maxlength="6" style="text-transform:uppercase;" />
                    <button id="btn-create-room" title="Gerar Nova Sala">üé≤</button>
                </div>
            </div>

            <div class="login-section">
                <label class="section-label">IDENTIDADE</label>
                <select id="username">
                    <option value="" disabled selected>Escolha seu Destino...</option>
                    <option value="O Louco">O Louco</option>
                    <option value="O Mago">O Mago</option>
                    <option value="A Papisa">A Papisa</option>
                    <option value="A Imperatriz">A Imperatriz</option>
                    <option value="O Eremita">O Eremita</option>
                    <option value="A Justi√ßa">A Justi√ßa</option>
                    <option value="O Pendurado">O Pendurado</option>
                    <option value="A Morte">A Morte</option>
                    <option value="A Temperan√ßa">A Temperan√ßa</option>
                    <option value="O Diabo">O Diabo</option>
                    <option value="A Torre">A Torre</option>
                    <option value="A Estrela">A Estrela</option>
                    <option value="A Lua">A Lua</option>
                    <option value="O Sol">O Sol</option>
                    <option value="O Julgamento">O Julgamento</option>
                    <option value="O Mundo">O Mundo</option>
                </select>
                <input type="password" id="password" placeholder="Senha (12345)" />
            </div>

            <button id="btn-join">Entrar na Mans√£o</button>
        </div>

        <!-- LOBBY -->
        <div id="lobby-screen" style="display:none;">
            <button id="btn-help" title="Ver Regras">?</button>
            <h3>Presentes no Sal√£o (<span id="player-count">0</span>):</h3>
            <ul id="player-list"></ul>
            
            <!-- CHAT DO LOBBY -->
            <div id="lobby-chat-container">
                <div id="lobby-chat-log"></div>
                <div class="chat-input-row">
                    <input type="text" id="lobby-chat-input" placeholder="Conversar no lobby..." autocomplete="off">
                    <button id="btn-lobby-chat">Enviar</button>
                </div>
            </div>

            <button id="btn-ready">Estou Pronto</button>
            <button id="btn-add-bot" style="background-color: #2c3e50; border-color: #4a6fa5;">+ Bot</button>
            <button id="btn-start">Iniciar Sess√£o</button>
            <button id="btn-leave" style="background-color: #3e2c2c; border-color: #a63737; margin-top: 10px; width: 100%;">Sair do Lobby</button>
        </div>

        <!-- JOGO PRINCIPAL -->
        <div id="game-screen" style="display:none;">
            <div class="main-layout">
                <div class="sidebar">
                    <div id="char-info">
                        <h3>Ficha</h3>
                        <p id="my-role">Caminho: ???</p>
                        <p>N√≠vel: <span id="my-level">1</span> <span style="font-size:0.8em; color:#777;">(XP acumulado)</span></p>
                        <p>Sanidade: <span id="my-sanity">10</span>/10</p>
                    </div>
                    <div id="actions">
                        <button onclick="sendAction('INVESTIGATE_OCCULT')">Investigar Oculto</button>
                        <div id="ability-container"></div> <!-- Bot√µes de Habilidade aparecer√£o aqui -->
                        <button onclick="startVoting()" style="margin-top: 5px; color: #a63737; border-color: #a63737;">Convocar Julgamento</button>
                        <button onclick="confirmSacrifice()" class="sacrifice-btn">Sacrif√≠cio Final</button>
                        <button onclick="openDiary()" style="margin-top: 5px;">Meu Di√°rio</button>
                        <button onclick="openClues()" style="margin-top: 5px; border-color: #4a6fa5; color: #8aa5d1;">Caderno de Pistas</button>
                        <div id="inventory-container" style="margin-top: 15px; border-top: 1px solid #5c4b36; padding-top: 10px;">
                            <h4 style="margin: 0 0 10px 0; color: #a63737;">Codinomes</h4>
                            <ul id="card-list" style="list-style: none; padding: 0;"></ul>
                        </div>
                    </div>
                </div>
                
                <div class="content">
                    <!-- √ÅREA DE EXPLORA√á√ÉO (CEN√ÅRIO) -->
                    <div id="exploration-view">
                        <div id="game-world">
                            <div id="vignette"></div>
                            <div id="spirit-vision-overlay"></div>
                        </div>
                        <div id="exploration-hud">
                            <div id="stats-bars">
                                <div class="bar-container"><div id="sanity-bar" class="bar-fill sanity" style="width: 100%;"></div></div>
                                <div class="bar-container"><div id="spirit-bar" class="bar-fill spirit" style="width: 100%;"></div></div>
                            </div>
                            <button id="btn-spirit-vision" class="hud-btn">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div id="table-view" style="display:none;"><div class="table-surface"></div></div>
                    <div id="room-controls" style="margin-bottom: 10px; padding: 5px; border: 1px solid #5c4b36; background: #111;">
                        <div style="margin-bottom:5px;">Local: <strong id="current-room">...</strong></div>
                        <div id="room-buttons" style="display:flex; gap:5px; flex-wrap:wrap;"></div>
                    </div>

                    <div id="log-tabs">
                        <button class="tab-btn active" onclick="switchTab('system')">Sistema</button>
                        <button class="tab-btn" onclick="switchTab('chat')">Chat</button>
                        <button class="tab-btn" onclick="switchTab('combat')">Combate</button>
                    </div>
                    <div id="log-box-system" class="log-box active">
                        <p class="system-msg">Bem-vindo √† Mans√£o Vitoriana.</p>
                    </div>
                    <div id="log-box-chat" class="log-box" style="display:none;">
                    </div>
                    <div id="log-box-combat" class="log-box" style="display:none;">
                    </div>
                    <div id="chat-controls">
                        <input type="text" id="chat-input" placeholder="Mensagem... (/w Nome, /o Ocultistas)" autocomplete="off" />
                        <button id="btn-send-chat">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>Shadow Of Mystery ¬© 2024</p>
            <button id="btn-credits" class="footer-btn">Cr√©ditos</button>
        </footer>
    </div>

    <!-- OVERLAY DE VOTA√á√ÉO -->
    <div id="voting-overlay" style="display:none;">
        <h2 style="color: #a63737;">O TRIBUNAL DAS SOMBRAS</h2>
        <p>Quem deve ser purgado?</p>
        <div id="voting-candidates"></div>
    </div>

    <!-- TELA DE MORTE -->
    <div id="death-overlay">
        VOC√ä EST√Å MORTO
    </div>

    <!-- TELA DE FIM DE JOGO -->
    <div id="game-over-screen" style="display:none;">
        <h1 id="winner-display">FIM DE JOGO</h1>
        <p id="win-reason" style="font-style: italic; margin-bottom: 20px;"></p>
        <h3>Revela√ß√£o dos Pap√©is:</h3>
        <ul id="reveal-list"></ul>
        <button onclick="location.reload()" style="margin-top: 20px;">Voltar ao Lobby</button>
    </div>

    <!-- EFEITO DE CHUVA DE SANGUE -->
    <div id="blood-rain-container"></div>

    <!-- DI√ÅRIO OVERLAY -->
    <div id="diary-overlay" style="display:none;">
        <div class="diary-paper">
            <h2>Di√°rio de Investiga√ß√£o</h2>
            <textarea id="diary-text" placeholder="Escreva suas suspeitas aqui..." spellcheck="false"></textarea>
            <button onclick="closeDiary()" class="diary-close-btn">Guardar Anota√ß√µes</button>
        </div>
    </div>

    <!-- CADERNO DE PISTAS OVERLAY -->
    <div id="clues-overlay" style="display:none;">
        <div class="clues-notebook">
            <h2>Pistas Coletadas</h2>
            <ul id="clues-list"></ul>
            <button onclick="closeClues()" class="clues-close-btn">Fechar Caderno</button>
        </div>
    </div>

    <!-- TUTORIAL OVERLAY -->
    <div id="tutorial-overlay" style="display:none;">
        <div class="fog-container">
            <div class="fog-layer"></div>
            <div class="fog-layer two"></div>
        </div>
        <div class="tutorial-content">
            <h2>Guia de Sobreviv√™ncia</h2>
            <div class="tutorial-body">
                <p>Bem-vindo √† Mans√£o. O V√©u est√° fino e algo profano caminha entre n√≥s.</p>
                
                <h3>üé≠ Os Caminhos (Pap√©is)</h3>
                <ul>
                    <li><strong>Observador (Detetive):</strong> Recebe pistas sobre a identidade do assassino.</li>
                    <li><strong>Sussurro (Ocultista):</strong> Inocente com conhecimentos arcanos.</li>
                    <li><strong>Carrasco (Assassino):</strong> Deve eliminar a todos. Ganha poder total durante o Ritual.</li>
                </ul>

                <h3>üëÅÔ∏è Sanidade & Ritual</h3>
                <p>A√ß√µes e ataques reduzem sua <strong>Sanidade</strong>. Se cair muito, voc√™ ver√° coisas que n√£o existem. Se a Sanidade Global colapsar, o <strong>Ritual</strong> come√ßa e o Carrasco pode matar livremente.</p>

                <p><em>Descubra o assassino e vote nele antes que seja tarde.</em></p>
            </div>
            <button id="btn-close-tutorial">Entendi, aceito meu destino.</button>
        </div>
    </div>

    <!-- CR√âDITOS OVERLAY -->
    <div id="credits-overlay" style="display:none;">
        <div class="credits-content">
            <h2>Cr√©ditos</h2>
            <p>Desenvolvido por:</p>
            <ul class="dev-list">
                <li>Gemini</li>
                <li>Manuzinha</li>
            </ul>
            <p class="dedication">Com amor para P.</p>
            <button id="btn-close-credits">Fechar</button>
        </div>
    </div>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="client.js"></script>
</body>
</html>